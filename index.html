<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wavelength â€” Song of the Week</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Crimson+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600&family=IBM+Plex+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
  --bg: #0d0000; --surface: #160505; --surface2: #1f0808; --border: #3a0a0a;
  --red: #cc1111; --red-bright: #ff2020; --white: #f0ece8; --text: #f0ece8; --text-muted: #a09890;
}
body {margin:0;background:var(--bg);color:var(--text);font-family:'Crimson Pro',serif;}
input,button {font-family:inherit;}
.view {display:none;}
.center-screen {display:flex;justify-content:center;align-items:center;height:100vh;}
.center-box {background:var(--surface);padding:2rem;border-radius:0.5rem;width:320px;text-align:center;}
.btn {padding:0.6rem 1rem;border:none;border-radius:3px;cursor:pointer;font-weight:600;transition:0.15s;}
.btn-primary {background:var(--red);color:var(--white);}
.btn-primary:hover {background:var(--red-bright);}
.btn-ghost {background:none;color:var(--red);}
.btn-danger {background:#600;color:#fff;}
input {width:100%;padding:0.5rem;margin:0.5rem 0;border:1px solid var(--border);border-radius:3px;background:var(--surface2);color:var(--text);}
.form-error {color:var(--red);font-size:0.8rem;}
.color-row {display:flex;gap:0.5rem;margin-top:0.5rem;justify-content:center;}
.color-swatch {width:30px;height:30px;border-radius:50%;cursor:pointer;border:2px solid transparent;}
.color-swatch.selected {border:2px solid var(--white);}
nav {display:flex;align-items:center;justify-content:space-between;padding:0.5rem 1rem;background:var(--surface2);}
nav .nav-link {margin:0 0.5rem;cursor:pointer;}
.feed-header, .page-header {padding:1rem;}
.members-grid, .feed-grid {display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:1rem;padding:1rem;}
.toast {position:fixed;bottom:1rem;left:50%;transform:translateX(-50%);background:var(--red-bright);color:#fff;padding:0.5rem 1rem;border-radius:4px;display:none;}
.card {padding:1rem;border-radius:5px;text-align:center;color:#fff;}
</style>
</head>
<body>

<!-- AUTH VIEW -->
<div class="view" id="view-auth">
  <div class="center-screen">
    <div class="center-box">
      <h1>ðŸŽµ Wavelength</h1>
      <p>One song. Every week.</p>
      <div>
        <button onclick="switchTab('signin')">Sign In</button>
        <button onclick="switchTab('signup')">Sign Up</button>
      </div>
      <div id="auth-signin">
        <input type="email" id="signin-email" placeholder="Email"/>
        <input type="password" id="signin-password" placeholder="Password"/>
        <button class="btn btn-primary" onclick="signIn()">Sign In â†’</button>
        <div class="form-error" id="signin-error"></div>
      </div>
      <div id="auth-signup" style="display:none">
        <input type="email" id="signup-email" placeholder="Email"/>
        <input type="password" id="signup-password" placeholder="Password"/>
        <button class="btn btn-primary" onclick="signUp()">Sign Up â†’</button>
        <div class="form-error" id="signup-error"></div>
      </div>
    </div>
  </div>
</div>

<!-- ONBOARDING -->
<div class="view" id="view-onboarding">
  <div class="center-screen">
    <div class="center-box">
      <h2>Setup Profile</h2>
      <input type="text" id="ob-name" placeholder="Display Name"/>
      <input type="text" id="ob-username" placeholder="Username"/>
      <div class="color-row" id="ob-colors"></div>
      <button class="btn btn-primary" onclick="createProfile()">Enter Wavelength â†’</button>
      <div class="form-error" id="ob-error"></div>
    </div>
  </div>
</div>

<!-- NAV -->
<nav id="mainNav" style="display:none">
  <div>ðŸŽµ Wavelength</div>
  <div>
    <span class="nav-link" onclick="showView('feed')">Feed</span>
    <span class="nav-link" onclick="showView('members')">Members</span>
    <span class="nav-link" onclick="showView('profile')">My Profile</span>
  </div>
  <div>
    <button class="btn btn-ghost" onclick="signOut()">Sign Out</button>
  </div>
</nav>

<!-- FEED -->
<div class="view" id="view-feed">
  <div class="feed-header"><h2>This Week's Picks</h2></div>
  <div class="feed-grid" id="feed-grid"></div>
</div>

<!-- MEMBERS -->
<div class="view" id="view-members">
  <div class="page-header"><h2>All Members</h2></div>
  <div class="members-grid" id="members-grid"></div>
</div>

<!-- PROFILE -->
<div class="view" id="view-profile">
  <div class="center-screen">
    <div class="center-box">
      <h2 id="profile-name"></h2>
      <p id="profile-username"></p>
      <div style="width:60px;height:60px;border-radius:50%;" id="profile-avatar"></div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// --- Supabase Setup ---
// <-- Replace with your Supabase project info -->
const SUPABASE_URL = "https://YOUR_PROJECT_REF.supabase.co";
const SUPABASE_KEY = "YOUR_ANON_PUBLIC_KEY";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let currentUser = null;
let currentProfile = null;

// --- Colors ---
const colors = ["#ff0000","#ff7700","#ffee00","#00ff55","#00aaff","#7700ff","#ff00ee"];
function buildColorPicker(containerId){
  const container=document.getElementById(containerId);
  container.innerHTML="";
  colors.forEach(c=>{
    const div=document.createElement("div");
    div.className="color-swatch"; div.style.background=c;
    div.onclick=()=>{container.querySelectorAll('.color-swatch').forEach(s=>s.classList.remove('selected')); div.classList.add('selected');};
    container.appendChild(div);
  });
}

// --- Toast ---
function showToast(msg){
  const t=document.getElementById('toast');t.textContent=msg;t.style.display='block';
  setTimeout(()=>{t.style.display='none'},2000);
}

// --- View Handling ---
function switchTab(tab){
  document.getElementById('auth-signin').style.display=(tab==='signin')?'block':'none';
  document.getElementById('auth-signup').style.display=(tab==='signup')?'block':'none';
}
function showView(view){
  document.querySelectorAll('.view').forEach(v=>v.style.display='none');
  document.getElementById('view-'+view).style.display='block';
}

// --- Auth ---
async function signIn(){
  const email=document.getElementById('signin-email').value;
  const password=document.getElementById('signin-password').value;
  const {data,error}=await sb.auth.signInWithPassword({email,password});
  if(error){document.getElementById('signin-error').textContent=error.message;return;}
  currentUser=data.user;
  await loadProfile();
}
async function signUp(){
  const email=document.getElementById('signup-email').value;
  const password=document.getElementById('signup-password').value;
  const {data,error}=await sb.auth.signUp({email,password});
  if(error){document.getElementById('signup-error').textContent=error.message;return;}
  currentUser=data.user;
  buildColorPicker('ob-colors');
  showView('onboarding');
}
async function signOut(){
  await sb.auth.signOut(); currentUser=null; currentProfile=null;
  document.getElementById('mainNav').style.display='none';
  showView('auth');
  showToast("Signed out!");
}

// --- Profile ---
async function createProfile(){
  const name=document.getElementById('ob-name').value;
  const username=document.getElementById('ob-username').value;
  const color=document.querySelector('#ob-colors .color-swatch.selected')?.style.background;
  if(!name||!username||!color){document.getElementById('ob-error').textContent="All fields required"; return;}
  const {data,error}=await sb.from('profiles').insert([{id:currentUser.id,name,username,color}]);
  if(error){document.getElementById('ob-error').textContent=error.message;return;}
  currentProfile=data[0];
  showMainViews();
}
async function loadProfile(){
  const {data,error}=await sb.from('profiles').select('*').eq('id',currentUser.id).single();
  if(data) currentProfile=data;
  showMainViews();
}
function showMainViews(){
  document.getElementById('mainNav').style.display='flex';
  showView('feed');
  loadFeed();
  loadMembers();
  loadProfilePage();
}

// --- Feed ---
async function loadFeed(){
  const {data,error}=await sb.from('weekly_picks').select('*,profiles(*)').order('created_at',{ascending:false});
  const feed=document.getElementById('feed-grid'); feed.innerHTML="";
  if(data) data.forEach(p=>{
    const d=document.createElement('div'); d.className="card"; d.style.background=p.profiles.color;
    d.innerHTML=`<strong>${p.profiles.name}</strong><br>${p.song}`;
    feed.appendChild(d);
  });
}

// --- Members ---
async function loadMembers(){
  const {data,error}=await sb.from('profiles').select('*');
  const grid=document.getElementById('members-grid'); grid.innerHTML="";
  if(data) data.forEach(u=>{
    const d=document.createElement('div'); d.className="card"; d.style.background=u.color;
    d.innerHTML=`<strong>${u.name}</strong><br>@${u.username}`;
    grid.appendChild(d);
  });
}

// --- Profile Page ---
function loadProfilePage(){
  if(!currentProfile) return;
  document.getElementById('profile-name').textContent=currentProfile.name;
  document.getElementById('profile-username').textContent="@"+currentProfile.username;
  document.getElementById('profile-avatar').style.background=currentProfile.color;
}

// --- Initialize ---
(async()=>{
  const {data:user}=await sb.auth.getUser();
  if(user){currentUser=user; await loadProfile();}
  else showView('auth');
})();
</script>

</body>
</html>
