-- Profiles
create table profiles (
  id uuid references auth.users primary key,
  username text unique not null,
  display_name text not null,
  color text default '#cc0000',
  created_at timestamptz default now()
);

-- Picks (one per user per week)
create table picks (
  id uuid default gen_random_uuid() primary key,
  user_id uuid references profiles(id) on delete cascade,
  week_number integer not null,
  song text not null,
  artist text not null,
  note text,
  tags text[],
  year text,
  band_info text,
  artwork_url text,
  created_at timestamptz default now(),
  unique(user_id, week_number)
);

-- Follows
create table follows (
  follower_id uuid references profiles(id) on delete cascade,
  following_id uuid references profiles(id) on delete cascade,
  created_at timestamptz default now(),
  primary key (follower_id, following_id)
);

-- Security
alter table profiles enable row level security;
alter table picks enable row level security;
alter table follows enable row level security;

create policy "Profiles public" on profiles for select using (true);
create policy "Insert own profile" on profiles for insert with check (auth.uid() = id);
create policy "Update own profile" on profiles for update using (auth.uid() = id);
create policy "Picks public" on picks for select using (true);
create policy "Manage own picks" on picks for all using (auth.uid() = user_id);
create policy "Follows public" on follows for select using (true);
create policy "Manage own follows" on follows for all using (auth.uid() = follower_id);
